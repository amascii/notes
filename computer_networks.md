**Book used**: マスタリングTCP/IP　入門編　第５版

Acronym|Meaning|Japanese|pg
---|---|---|---
CIDR|Classless Inter-Domain Routing|クラスに縛られない組織間の経路制御|154
VLSM|Variable Length Subnet Mask|可変長サブネットマスク|155

# 1 ネットワーク基礎知識
## 1.1 登場の背景
- コンピュータの普及と多様化
- スタンドアロン（単体） -> ネットワーク利用（複数のコンピュータを互いに接続する）
- WAN/LAN: Wide/Local Area Network
- 情報の共有：早く、遠く
- 神経のような役割

## 1.2 発展の７つの段階
時代 | メモ
:---: | ---
バッチ処理 | プログラム・データをまとめて、管理者に与え、一括に処理
タイムシェアリングシステム(TSS) | １台のコンピュータに複数の端末、仮想的に1人に1台
コンピュータ間通信 | コンピュータとコンピュータを接続（社内）
コンピュータネットワーク | 異なるメーカーのコンピュータの通信（会社間）
インターネットの普及 | downsizing, multivendor, WWW・E-mail
インターネット技術中心 | 利用性 -> 安全性
いつでもどこでも何にでもTCP/IPネットワーク | 


## 1.3 プロトコルとは
### プロトコル
- 決まり事
- コミュニケーションを取るため
- データ形式・処理手順
    
### パケット交換におけるプロトコル
- 大きなデータをパケットという単位で分割して送信する。
- ヘッダーに送信元・宛先アドレスやデータ番号</li>
- データの再構築</li>
- ヘッダーの情報・処理方法はプロトコルによって決まる

## 1.4 プロトコルの標準化
- 標準化により、異なるメーカーの製品同士でも互換性を持って利用できる。その結果、機器選択の自由度が増し、ユーザの利便性が向上する。

## 1.5 プロトコルの階層化／OSI参照モデル
### 階層化
**インタフェース**：上位層・下位層の間でサービスのやり取り<br>
**プロトコル**：通信相手の同じ階層とのやり取り
- 複雑なプロセスを単純化 -> ある機能に中心し、考えることができる、実装・変更しやすくなる
- 各層は独立している -> ある層の変更は他の層に影響を与えない
- インタフェース -> 異なるメーカーの機器を接続可能

### OSI参照モデル
Please Do Not Throw Such Pizza Away<br>
**レイヤ1~3**：物理的な通信経路の確立を担当<br>
**レイヤ4~7**：終端ノード間の論理的な通信を担当

## 1.6 OSI参照モデルの各層の役割
カプセル化：各レイヤの処理に必要な情報をヘッダに書き込み、入れ子構造になる
- 各レイヤの処理の単純化・並列実行も可能
- メモリ・データマネジメントが複雑化面も

＃ | 層 | 役割 | 例
--- | --- | --- | ---
7 | アプリケーション層 | 特定のアプリケーションに特化したプロトコル | 電子メール・遠隔ログイン・ファイル転送
6 | プレゼンテーション層 | 機器固有のデータフォーマットと、ネットワーク共通のデータフォーマットの交換 |  通信・処理に適したデータ形式への変換
5 | セッション層 | 通信の管理。コネクションの確立・切断。トランスポート層以下の層を管理。 | コネクションをいつ確立していつ切断する？いくつ張る？
4 | トランスポート層 | 終端ノード間のデータ転送の管理。データ転送の信頼性を提供する。 | データの抜けがないか？ 
3 | ネットワーク層 | アドレスの管理と経路の選択 | 経路制御   
2 | データリンク層 | 直接接続された機器間でのデータフレームの識別と転送 | １区間の転送・フレームとビット列の変換 
1 | 物理層 | 0と1を電圧や光で表す | コネクタやケーブルの形状を規定

## 1.7 通信方式の種類
**コネクション型**：データを通信する前に相手との接続を確立<br>
**コネクションレス型**：確認せずデータを通信

**回線交換**：ノード間でコネクションを確立し、切断されるまで回線は占有利用される<br>
**パケット交換**：データをパケットとして細分化し、回線を共有しながら効率的に利用される

**ユニキャスト**：１対１<br>
**ブロードキャスト**：放送。１対みんな。範囲はブロードキャストドメインによる<br>
**マルチキャスト**：１対特定のグループ<br>
**エニーキャスト**：マルチキャストのようだが最適な条件を持つ対象一つを選んで送信

## 1.8 アドレスとは
- 唯一性を持つ -> アドレスによって送信元と受信先を特定できる
- 階層化 -> 同定が容易になる（IPにあり、MACになし）

### 転送制御
転送表(Forwarding table)
経路制御表(Routing table)

層 | アドレス | テーブル
--- | --- | ---
データリンク層 | MACアドレス | 転送表
ネットワーク層 | IPアドレス | 経路制御表
トランスポート層 | ポート番号 | n/a

## 1.9 ネットワークの構成要素
機器|役割
---|---
ネットワークインタフェース|コンピュータをネットワークに接続する(NIC)
リピータ|物理層で信号を増幅したり延長する
ブリッジ／L2スイッチ|データリンク層でネットワーク同士を接続する・FCSを使って、壊れていないデータのみを伝える・MACアドレスを学習できる
ルータ／L3スイッチ|ネットワーク層によってパケットを転送する・（TCP/IPでは）IPアドレスを使う・異なるデータリンクのネットワークを接続する
L4-7スイッチ|例：Load balancer, 通信の優先など
ゲートウェイ|プロトコルの翻訳・中継を行う　例：携帯電話とコンピュータの電子メールプロトコル

# 2 TCP/IP基礎知識
## 2.1 登場の背景
1969 - ARPANET - パケット交換ネットワーク　障害に強い
1982-3 TCP/IP - UNIX・ARPANETに使用される

## 2.2 標準化
TCP/IP = インターネットプロトコルスイート = （IPで通信する際に利用される）プロトコル群の総称

OSI
- 論理を重視
- 複雑
- 標準化プロセスに時間がかかる

TCP/IP
- オープン
- 早いプロセス
- 実用性重視

Internet draft (2 weeks) -> IETFの承認、RFCに登録 -> Proposed standard (6 months) -> Draft standard (4 months) -> Standard

## 2.3 インターネットの基礎知識
**インターネット**: 全世界を接続しているコンピュータネットワークのこと

## 2.4 TCP/IPの階層モデル
### ハードウェア・ネットワークインタフェース層
- **ハードウェア**: L1に相当
- イーサネット、無線、光回線など
- 規定なし
- 接続された装置間での通信を前提
- **ネットワークインタフェース**: L2に相当
- データリンクを利用するためのインタフェース
- NICのデバイスドライバ

### インターネット層
L3に相当、IPアドレスによるパケット転送、ホストOSへの組み込みを想定
- IP (Internet Protocol): パケット交換プロトコル
- ICMP (Internet Control Message Protocol): ネットワーク診断（pingなど）
- ARP (Address Resolution Protocol): MACアドレス取得

### トランスポート層
アプリケーションプログラム間の通信を実現、ポート番号を用いてアプリケーションプログラムを識別
- TCP (Transmission Control Protocol): コネクション型、信頼性、輻輳制御
- UDP (User Datagram Protocol): コネクションレス型、軽量、リアルタイム性

### アプリケーション層
L5~L7に４相当、基本はクライアント／サーバモデル
**WWW (World Wide Web)**
- WebブラウザでWebサーバから情報を取得
- プロトコルはHTTP (Hypertext Transfer Protocol)、データ形式はHTML (Hypertext Markup Language)
**電子メール** 
- 送信には、SMTP (Simple Mail Transfer Protocol)
- データ形式を拡張するMIME (Multipurpose Internet Mail Extensions)で画像・音声も送信可能
- 受信には、POP (Post Office Protocol)、IMAP (Internet Message Access Protocol)
**その他**
- ファイル転送: FTP (File Transfer Protocol)
- 遠隔ログイン: TELNET, SSH
- ネットワーク管理: SNMP (Simple Network Management Protocol) 障害の発見や情報収集

## 2.5 TCP/IPの階層モデルと通信例
 
# 3 データリンク
## 3.1 データリンクの役割
- 通信媒体で直接接続された機器間で通信するための仕様を規定
- ツイストペアケーブル，同軸ケーブル，光ファイバ，電波，赤外線など
- L1: 0/1ビット列, L2: Frame単位

トポロジー
- バス型
- リング型
- スター型
- メッシュ型
## 3.2 データリンクの技術
### MACアドレス
- データリンク内のノードを識別するアドレス
- NICに対して一意に割り当てる
- 48ビット　1ユニ・マルチキャスト　2ユニバーサル・ローカルアドレス　23~24ベンダ識別子　25~48ベンダ内での識別子

**全二重通信**：送・受信は同時に行える
**半二重通信**：ある瞬間に一つだけができる

### 媒体共有型のネットワーク
- 通信ノードを複数のノードで共有する
- 半二重 -> コンテンション方式 (CSMA: Carrier Sense Multiple Access)
- 混雑 -> 性能低下
- CSMA/CD (CSMA w/ Collision Detection)　
- 衝突を検出 -> 送信を中止 -> 乱数時間待つ -> 再送信 
- トークンパッシング方式 -> トークンを持つノードのみ送信可能 
- 衝突が発生しない -> 混雑時の性能低下が小さい
- トークンが回ってくるまで待つ -> 効率性が落ちる

### 媒体非共有型のネットワーク
- 全二重
- ノードをスイッチに接続、スイッチがフレームを転送
- スイッチが故障 ->　通信はすべてだめになる

### MACアドレスによる転送
- スイッチはMACアドレスとポートの対応を自己学習し，フォワーディングテーブルを自動生成
- 階層性がない -> スケーラビリティは小さい

### ループ検出とスパニングツリー
- データリンクにループ -> フレームが永久にコピーされる -> メルトダウン
- スパニングツリー -> 1~10秒間隔で専用パケットをブリッジ間で
交換して使用しないポートを決定し、ネットワークを論理的にツリー構造化
- 障害発生時には通信路を自動的に切り替わる

### VLAN
- 仮想的（論理的）にネットワークを構成し，異なる VLAN 間の通信を全て遮断
- 物理的な配線を変えずにネットワークの構造を変える
- ブロードキャストドメインを区切り、負荷軽減やセキュリティ向上
- セグメントごとに一意となる VLAN ID (VID) を設定
- 上手に管理・運用する必要がある

## 3.3 イーサネット

# 4 IPアドレスの基礎知識

